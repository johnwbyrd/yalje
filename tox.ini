[tox]
# Test on Python 3.10, 3.11, 3.12 (matching CI)
envlist = py{310,311,312},lint,typecheck
isolated_build = True
skip_missing_interpreters = True

[testenv]
# Default environment: run pytest with coverage
description = Run tests with pytest
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
commands =
    pytest --cov=yalje --cov-report=term-missing --cov-report=html --cov-report=xml {posargs}

[testenv:lint]
# Linting and formatting checks
description = Run ruff linter and formatter checks
deps = ruff>=0.1.0
skip_install = True
commands =
    ruff check src/ tests/
    ruff format --check src/ tests/

[testenv:format]
# UTILITY: Auto-fix formatting issues (NOT part of test suite)
description = Auto-format code with ruff (utility command, not a test)
deps = ruff>=0.1.0
skip_install = True
commands =
    ruff check --fix src/ tests/
    ruff format src/ tests/

[testenv:typecheck]
# Type checking with mypy
description = Run mypy type checker
deps =
    mypy>=1.5.0
    types-requests
    types-pyyaml
    types-python-dateutil
commands =
    mypy src/yalje

[testenv:dev]
# Fast development environment (current Python only)
description = Run all checks on current Python version (fast)
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
    mypy>=1.5.0
    ruff>=0.1.0
    types-requests
    types-pyyaml
    types-python-dateutil
commands =
    ruff check src/ tests/
    ruff format --check src/ tests/
    mypy src/yalje
    pytest --cov=yalje --cov-report=term-missing {posargs}

[testenv:all]
# Run absolutely everything
description = Run all quality checks (lint + typecheck + tests)
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
    mypy>=1.5.0
    ruff>=0.1.0
    types-requests
    types-pyyaml
    types-python-dateutil
commands =
    ruff check src/ tests/
    ruff format --check src/ tests/
    mypy src/yalje
    pytest --cov=yalje --cov-report=term-missing --cov-report=html {posargs}
